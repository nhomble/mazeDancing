#!/usr/bin/env python2

import time
import sys

# ROS specifoc
import roslib; roslib.load_manifest('mazeDancing')
import rospy
from std_msgs.msg import String

# my modules
from Move_Manager  import *

# take N steps
def right_wall_follower(move, maze, speech, N=7, stall=5):
	speech.publish("start")
	for _ in range(N):
		speech.publish(str(_))
		rospy.loginfo("check right")
		## check right
		# turn right
		speech.publish("check right")
		move.move(Direction.RIGHT)
		time.sleep(stall)
		# check the right side of depth cloud
		if move.check(Direction.RIGHT):
			speech.publish("its open")
			rospy.loginfo("move forward because gap in wall")
			move.move(Direction.FORWARD)
			continue
		rospy.loginfo("nudge")
		# we got a wall, so adjust a little to be at goal distance
		#move.nudge()
		# reset
		speech.publish("reset left")
		rospy.loginfo("reset left")
		move.move(Direction.LEFT)
		time.sleep(stall)
		## check forward
		speech.publish("check forward")
		if move.check(Direction.FORWARD):
			rospy.loginfo("forward")
			move.move(Direction.FORWARD)
		else:
			rospy.loginfo("turn left cause ahead is blocked")
			move.move(Direction.LEFT)
	move.maze.print_maze()
			

def checks(move):
	while True:
		print(move._checks)
		print("{} {} {}".format(move.check(Direction.FORWARD), move.check(Direction.LEFT), move.check(Direction.RIGHT)))
		rospy.Rate(5).sleep()

# ROS loop
def main():
	speech = rospy.Publisher(SPEECH_IO, String)
	move = Move_Manager()
	maze = Maze()
	right_wall_follower(move, maze, speech)
	#checks(move)
	return 

if __name__ == "__main__":
	try:
		rospy.init_node('wall_follower')
		sys.exit(main())
	except rospy.ROSInterruptException:
		pass
